import{D as z,M as E}from"./DoubleCheckModal-CI_7pJau.js";import{g as k,m as C,_ as V,o as n,c as r,a as e,n as U,z as u,C as b,F as f,h as y,t as h,f as v,B as L,d as c,D as g,A as _,b as w,r as x}from"./index-CR0-yHkY.js";import{u as A,a as D,b as B}from"./component-functions-By1xdr6b.js";const O={data(){return{modal:null,filteredNts:[],nts:[],product:null,productList:null,localBaseClaimNts:[],localNewClaimNts:[],enName:"",chName:"",unit:"公克(g)",type:"以上皆非",localMyAddedNtsList:[],myAddedNts:[],filteredMyAddedNts:[],searchText:"",editEnName:"",editChName:"",editIndex:""}},components:{DoubleCheckModal:z},computed:{...k(A,["headerChineseAndEnglish","myProductList"]),...k(D,["baseClaimNts","newClaimNts","customizeData","customizeDataList","myAddedNtsList"]),toDoText(){let s="";return this.editIndex!==""&&(s="更新營養素"),this.editIndex===""&&(s="新增營養素"),s}},watch:{baseClaimNts:{handler(s){this.localBaseClaimNts=s},deep:!0,immediate:!0},newClaimNts:{handler(s){this.localNewClaimNts=s},deep:!0,immediate:!0},myAddedNtsList:{handler(){this.getMyAddedNts()},deep:!0,immediate:!0}},methods:{...C(A,["setMyProducts","pushNTs"]),...C(D,["addNts","showCustomizeDataClaimNts"]),...C(B,["openAlert"]),updateOptionData(){this.getMyAddedNts();const s=["id","category","sample_name","common_name","content_description","scrap_rate","calories","corrected_calories","protein","fat","saturated_fat","total_carbohydrates","total_sugar","sodium","trans_fat"];this.nts={...this.headerChineseAndEnglish},s.forEach(t=>{delete this.nts[t]}),this.filteredNts=this.nts},search(s){this.filteredNts=Object.fromEntries(Object.entries(this.nts).filter(([t,o])=>o.match(s)||t.match(s))),this.filteredMyAddedNts=Object.fromEntries(Object.entries(this.myAddedNts).filter(([t,o])=>t.match(s)||o.match(s)))},showModal(s){s&&this.showCustomizeDataClaimNts(s),this.modal.show()},update(){this.addNts(this.localBaseClaimNts,this.localNewClaimNts),this.hideModal()},hideModal(){this.modal.hide()},submitForm(s){const t=s.target;if(!t.checkValidity()){t.classList.add("was-validated"),this.openAlert(!0,"還有必填欄位喔！");return}this.addOrEditNt()},addOrEditNt(){this.editIndex!==""&&this.localMyAddedNtsList.splice(1,this.editIndex);const s={type:this.type,enName:this.enName,chName:this.chName,unit:this.unit,quantity:""};this.localNewClaimNts.push(this.enName),this.localMyAddedNtsList.push(s),localStorage.setItem("myAddedNts",JSON.stringify(this.localMyAddedNtsList)),this.getMyAddedNts(),this.type="以上皆非",this.enName="",this.chName="",this.unit="公克(g)",this.searchText="",this.filteredNts=this.nts},bringInEditData(s,t,o){this.filteredMyAddedNts=[],this.filteredNts=[],this.editIndex=o,this.enName=t,this.editEnName=t,this.chName=s.replace(/\(.*\)/,""),this.editChName=s.replace(/\(.*\)/,"");const N=s.match(/\((.*?)\)/)[1];N==="g"&&(this.unit="公克(g)"),N==="mg"&&(this.unit="毫克(g)"),N==="ug"&&(this.unit="微克(g)"),this.myAddedNtsList.forEach(l=>{l.enName===this.editEnName&&(this.type=l.type)})},getMyAddedNts(){const s=JSON.parse(localStorage.getItem("myAddedNts"))||[];this.localMyAddedNtsList=s;let t={};s.forEach(o=>{t[o.enName]=o.chName+"("+o.unit.match(/\((.*?)\)/)[1]+")"}),this.myAddedNts=t,this.filteredMyAddedNts=t},openDoubleCheckModal(s,t,o){this.$refs.doubleCheckModal.showDelNtModal(s,t,o)},used(s){let t=!1;return this.customizeDataList.forEach(o=>{o.newClaimNts&&o.newClaimNts.some(N=>{N.enName===s&&(t=!0)})}),t},alreadlyHaveEnName(s){const t=s.target.value;this.localMyAddedNtsList.forEach(o=>{o.enName===t&&this.editEnName!==t&&(this.openAlert(!0,"『 "+t+" 』已存在！"),this.enName="")}),Object.keys(this.headerChineseAndEnglish).forEach(o=>{o.replace(/\(.*\)/,"")===t&&(this.openAlert(!0,"『 "+t+" 』已存在內建資料庫！"),this.enName="")})},alreadlyHaveChName(s){const t=s.target.value;this.localMyAddedNtsList.forEach(o=>{o.chName===t&&this.editChName!==t&&(this.openAlert(!0,"『 "+t+" 』已存在！"),this.chName="")}),Object.values(this.headerChineseAndEnglish).forEach(o=>{o.replace(/\(.*\)/,"")===t&&(this.openAlert(!0,"『 "+t+" 』已存在內建資料庫！"),this.chName="")})},cancelUpdate(){this.getMyAddedNts(),this.updateOptionData()}},created(){this.updateOptionData()},mounted(){this.modal=new E(this.$refs.nutrientsModal)}},j={ref:"nutrientsModal",class:"modal",tabindex:"-1"},I={class:"rounded-4 modal-dialog modal-dialog-scrollable"},S={class:"rounded-4 modal-content"},q={class:"p-2 bg-light form-floating d-flex justify-content-center"},F={key:0,class:"bg-light pb-2 border-bottom d-flex flex-wrap justify-content-start align-items-center"},T={class:"addedNts w-100 ms-3"},H={class:"modal-body"},P={key:0},J={class:"ms-1"},R={class:"form-floating mb-3"},W={class:"form-floating mb-3"},G={class:"mt-2 ms-2 mb-3"},K={class:"form-check form-check-inline"},Q={class:"form-check form-check-inline"},X={class:"form-check form-check-inline"},Y={class:"mt-2 ms-2 mb-3"},Z={class:"form-check form-check-inline"},$={class:"form-check form-check-inline"},tt={class:"form-check form-check-inline"},et={class:"form-check form-check-inline"},st={class:"d-flex"},lt={type:"submit",class:"col btn btn-sm btn-primary"},it={key:1},at={class:"col-4 col-sm-3"},ot=["value","id"],dt=["for"],nt={class:"d-flex align-items-center"},rt=["onClick","disabled"],mt=["onClick","disabled"],ut={key:0,class:"infoText mb-0 px-2 text-secondary"},ct={key:1,class:"infoText px-2 text-secondary mb-0"},ht=["id","value"],pt=["for"],ft={class:"bg-light modal-footer"},bt=["disabled"];function Nt(s,t,o,N,l,d){const M=x("DoubleCheckModal");return n(),r(f,null,[e("div",j,[e("div",I,[e("div",S,[e("div",{class:U(["border-0 pt-2 pb-3 bg-primary text-white modal-header flex-column align-items-start",l.localBaseClaimNts.length>0||l.localNewClaimNts.length>0?"":"border-bottom"])},t[18]||(t[18]=[e("div",{class:"w-100 mb-2 d-flex justify-content-between","data-bs-theme":"dark"},[e("h4",{class:"modal-title p-1"},"新增其他營養素"),e("button",{type:"button",class:"btn-close mt-1","data-bs-dismiss":"modal","aria-label":"Close"})],-1)]),2),e("section",q,[u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>l.searchText=i),onChange:t[1]||(t[1]=i=>d.search(i.target.value.trim())),type:"search",class:"form-control",id:"searchInput",placeholder:"請輸入欲新增營養素搜尋"},null,544),[[b,l.searchText]]),t[19]||(t[19]=e("label",{for:"searchInput",class:"m-2"}," 搜尋 中文 或 英文 營養素 ",-1))]),l.localBaseClaimNts.length>0||l.localNewClaimNts.length>0?(n(),r("section",F,[t[20]||(t[20]=e("p",{class:"ms-3 ps-1 mb-0"},"已新增營養素：",-1)),e("div",T,[(n(!0),r(f,null,y(l.localBaseClaimNts,(i,a)=>(n(),r("span",{key:i+a,class:"badge text-primary-emphasis bg-primary-subtle fs-6 m-1"},h(l.nts[i].replace(/\(.*\)/,"")),1))),128)),(n(!0),r(f,null,y(l.localNewClaimNts,(i,a)=>(n(),r("span",{key:a,class:"badge text-light bg-primary fs-6 m-1"},h(l.myAddedNts[i].replace(/\(.*\)/,"")),1))),128))])])):v("",!0),e("div",H,[Object.values(l.filteredNts).length===0&&Object.values(l.filteredMyAddedNts).length===0?(n(),r("section",P,[t[34]||(t[34]=e("p",{class:"mt-2 mb-4 text-center fw-bold fs-4 text-primary"}," 查無相符品項 ",-1)),e("form",{onSubmit:t[14]||(t[14]=L((...i)=>d.submitForm&&d.submitForm(...i),["prevent"])),novalidate:""},[e("h5",J,h(d.toDoText),1),e("div",R,[u(e("input",{onChange:t[2]||(t[2]=i=>d.alreadlyHaveEnName(i)),"onUpdate:modelValue":t[3]||(t[3]=i=>l.enName=i),type:"text",class:"form-control",id:"enName",placeholder:"營養素『 英文 』名稱 或 縮寫",required:""},null,544),[[b,l.enName,void 0,{trim:!0}]]),t[21]||(t[21]=e("div",{class:"invalid-feedback"},"此欄位為必填",-1)),t[22]||(t[22]=e("label",{for:"enName"},[e("i",{class:"text-danger fst-normal"},"＊"),c(" 營養素『 英文 』名稱 或 縮寫 ")],-1))]),e("div",W,[u(e("input",{onChange:t[4]||(t[4]=i=>d.alreadlyHaveChName(i)),"onUpdate:modelValue":t[5]||(t[5]=i=>l.chName=i),type:"text",class:"form-control",id:"chName",placeholder:"營養素『 中文 』名稱",required:""},null,544),[[b,l.chName,void 0,{trim:!0}]]),t[23]||(t[23]=e("div",{class:"invalid-feedback"},"此欄位為必填",-1)),t[24]||(t[24]=e("label",{for:"chName"},[e("i",{class:"text-danger fst-normal"},"＊"),c(" 營養素『 中文 』名稱 ")],-1))]),e("div",G,[t[28]||(t[28]=e("p",{class:"mb-2 fw-bold"},[e("i",{class:"text-danger fst-normal me-1"},"＊"),c(" 營養素單位 ")],-1)),e("div",K,[u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=i=>l.unit=i),class:"form-check-input",type:"radio",id:"gram",value:"公克(g)"},null,512),[[g,l.unit]]),t[25]||(t[25]=e("label",{class:"form-check-label",for:"gram"},"公克 (g)",-1))]),e("div",Q,[u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=i=>l.unit=i),class:"form-check-input",type:"radio",id:"milligram",value:"毫克(mg)"},null,512),[[g,l.unit]]),t[26]||(t[26]=e("label",{class:"form-check-label",for:"milligram"}," 毫克 (mg) ",-1))]),e("div",X,[u(e("input",{"onUpdate:modelValue":t[8]||(t[8]=i=>l.unit=i),class:"form-check-input",type:"radio",id:"microgram",value:"微克(ug)"},null,512),[[g,l.unit]]),t[27]||(t[27]=e("label",{class:"form-check-label",for:"microgram"}," 微克 (ug) ",-1))])]),e("div",Y,[t[33]||(t[33]=e("p",{class:"mb-2 fw-bold"},[e("i",{class:"text-danger fst-normal me-1"},"＊"),c(" 營養素類別 "),e("i",{class:"bi bi-info-circle ms-2 me-1 text-secondary"}),e("span",{class:"text-secondary fw-normal"}," 以下選擇與熱量計算有關 ")],-1)),e("div",Z,[u(e("input",{"onUpdate:modelValue":t[9]||(t[9]=i=>l.type=i),class:"form-check-input",type:"radio",id:"fiber",value:"膳食纖維"},null,512),[[g,l.type]]),t[29]||(t[29]=e("label",{class:"form-check-label",for:"fiber"},"膳食纖維",-1))]),e("div",$,[u(e("input",{"onUpdate:modelValue":t[10]||(t[10]=i=>l.type=i),class:"form-check-input",type:"radio",id:"sugar_alcohol",value:"糖醇"},null,512),[[g,l.type]]),t[30]||(t[30]=e("label",{class:"form-check-label",for:"sugar_alcohol"}," 糖醇 ",-1))]),e("div",tt,[u(e("input",{"onUpdate:modelValue":t[11]||(t[11]=i=>l.type=i),class:"form-check-input",type:"radio",id:"organic_acid",value:"有機酸"},null,512),[[g,l.type]]),t[31]||(t[31]=e("label",{class:"form-check-label",for:"organic_acid"}," 有機酸 ",-1))]),e("div",et,[u(e("input",{"onUpdate:modelValue":t[12]||(t[12]=i=>l.type=i),class:"form-check-input",type:"radio",id:"none",value:"以上皆非"},null,512),[[g,l.type]]),t[32]||(t[32]=e("label",{class:"form-check-label",for:"none"},"以上皆非",-1))])]),e("div",st,[e("button",{onClick:t[13]||(t[13]=(...i)=>d.cancelUpdate&&d.cancelUpdate(...i)),type:"button",class:"col btn btn-sm btn-secondary me-2"}," 取消 "),e("button",lt,h(d.toDoText),1)])],32)])):(n(),r("section",it,[(n(!0),r(f,null,y(l.filteredMyAddedNts,(i,a,m)=>(n(),r("div",{key:a,class:"form-check ps-4 ms-2 d-flex align-items-center"},[e("div",at,[u(e("input",{"onUpdate:modelValue":t[15]||(t[15]=p=>l.localNewClaimNts=p),value:a,id:a,class:"form-check-input",type:"checkbox"},null,8,ot),[[_,l.localNewClaimNts]]),e("label",{for:a,class:"form-check-label"},h(i),9,dt)]),e("div",nt,[e("button",{onClick:p=>d.bringInEditData(i,a,m),disabled:l.localNewClaimNts.includes(a)||d.used(a),type:"button",class:"btn btn-sm btn-outline-primary border-0 bi bi-pencil-square me-1"},null,8,rt),e("button",{onClick:p=>d.openDoubleCheckModal(i,a,m),disabled:l.localNewClaimNts.includes(a)||d.used(a),type:"button",class:"btn btn-sm btn-outline-danger border-0 bi bi-trash3"},null,8,mt),e("div",null,[l.localNewClaimNts.includes(a)&&!d.used(a)?(n(),r("p",ut,t[35]||(t[35]=[e("i",{class:"bi bi-info-circle"},null,-1),c(" 若需刪除，則取消勾選 ")]))):v("",!0),d.used(a)?(n(),r("p",ct,t[36]||(t[36]=[e("i",{class:"bi bi-info-circle"},null,-1),c(" 自定義資料中已使用，不予編輯及刪除 ")]))):v("",!0)])])]))),128)),(n(!0),r(f,null,y(l.filteredNts,(i,a)=>(n(),r("div",{key:a,class:"form-check px-4 py-1 ms-2"},[u(e("input",{"onUpdate:modelValue":t[16]||(t[16]=m=>l.localBaseClaimNts=m),id:a,value:a,class:"form-check-input",type:"checkbox"},null,8,ht),[[_,l.localBaseClaimNts]]),e("label",{for:a,class:"form-check-label"},h(i),9,pt)]))),128))]))]),e("div",ft,[t[37]||(t[37]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{onClick:t[17]||(t[17]=(...i)=>d.update&&d.update(...i)),disabled:Object.values(l.filteredNts).length===0&&Object.values(l.filteredMyAddedNts).length===0,type:"button",class:"btn btn-primary"}," 更新 ",8,bt)])])])],512),w(M,{ref:"doubleCheckModal"},null,512)],64)}const gt=V(O,[["render",Nt],["__scopeId","data-v-ad987b1a"]]),yt={data(){return{modal:null,header:[],filteredHeader:[],nutrients:{calories:"熱量(kcal)",protein:"蛋白質(g)",fat:"脂肪(g)",saturated_fat:"飽和脂肪(g)",trans_fat:"反式脂肪(g)",total_carbohydrates:"碳水化合物(g)",total_sugar:"糖(g)",sodium:"鈉(mg)"}}},components:{CustomizeClaimNtsModal:gt,DoubleCheckModal:z},watch:{headerChineseAndEnglish:{handler(s){return this.getHeader(),s},deep:!0,immediate:!0},customizeModal:{handler(s){s.switch===!1&&this.hideModal()},deep:!0,immediate:!0}},computed:{...k(A,["headerChineseAndEnglish","myProductList","baseFoodData"]),...k(D,["newClaimNts","customizeData","baseClaimNts","customizeModal"]),getStyle(){return window.innerWidth<483?"pt-5":""}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()},...C(B,["openAlert"]),getHeader(){const s={...this.headerChineseAndEnglish};["id","category","sample_name","common_name","content_description","scrap_rate","calories","corrected_calories","protein","fat","saturated_fat","total_carbohydrates","total_sugar","sodium","trans_fat"].forEach(t=>{delete s[t]}),this.header=s,this.filteredHeader=s},submitForm(s){const t=s.target;if(!t.checkValidity()){t.classList.add("was-validated"),this.openAlert(!0,"還有必填欄位喔！");return}this.$refs.doubleCheckModal.showModal("customize")},openModal(){this.$refs.customizeClaimNtsModal.showModal(this.customizeData)}},mounted(){this.modal=new E(this.$refs.customizeBaseDataModal)},created(){this.getHeader()}},Ct={ref:"customizeBaseDataModal",class:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},vt={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl"},kt={class:"modal-content"},Mt={class:"modal-body"},wt={class:"py-3 col-12 col-lg"},xt={class:"form-floating mb-3"},At={class:"form-floating"},Dt={class:"py-3 col-auto mb-5 mx-auto"},_t={class:"mb-4"},zt={class:"fw-normal px-3"},Et={class:"col-6 col-sm-auto"},Vt=["onUpdate:modelValue","name","id"],Ut={class:"fw-normal px-3"},Lt=["onUpdate:modelValue","name","id"],Bt={class:"fw-normal px-3"},Ot=["onUpdate:modelValue","id","name"];function jt(s,t,o,N,l,d){const M=x("CustomizeClaimNtsModal"),i=x("DoubleCheckModal");return n(),r(f,null,[e("div",Ct,[e("div",vt,[e("div",kt,[t[14]||(t[14]=e("div",{class:"modal-header bg-primary text-white","data-bs-theme":"dark"},[e("h3",{class:"modal-title"},"新增自訂義資料"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Mt,[e("form",{id:"AddCustomizeForm_id",onSubmit:t[3]||(t[3]=L((...a)=>d.submitForm&&d.submitForm(...a),["prevent"])),class:"row m-0 flex-wrap justify-content-between",novalidate:""},[e("div",wt,[e("div",xt,[u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.customizeData.sample_name=a),type:"text",class:"form-control",id:"sample_name",placeholder:"食材名稱",required:""},null,512),[[b,s.customizeData.sample_name,void 0,{trim:!0}]]),t[4]||(t[4]=e("div",{class:"invalid-feedback"},"此欄位為必填",-1)),t[5]||(t[5]=e("label",{for:"sample_name",class:""},[e("i",{class:"text-danger fst-normal"},"＊"),c(" 食材名稱 ")],-1))]),e("div",At,[u(e("textarea",{style:{height:"200px"},"onUpdate:modelValue":t[1]||(t[1]=a=>s.customizeData.content_description=a),type:"text",class:U(["form-control",d.getStyle]),id:"content_description",placeholder:"成分 （ 填入相同於包裝上顯示的成分 ）",required:""},null,2),[[b,s.customizeData.content_description,void 0,{trim:!0}]]),t[6]||(t[6]=e("div",{class:"invalid-feedback"},"此欄位為必填",-1)),t[7]||(t[7]=e("label",{for:"content_description",class:"text-wrap"},[e("i",{class:"text-danger fst-normal"},"＊"),c(" 成分：填入包裝上成分，內容及順序須相同 ")],-1))])]),e("div",Dt,[e("table",_t,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",{colspan:"2",class:"px-3 fs-5"}," 營養標示 - 依包裝上的數值填入 ")])],-1)),e("tbody",null,[t[12]||(t[12]=e("tr",{class:"text-center"},[e("th"),e("td",{class:"py-2"},"每 100 公克 / 毫升")],-1)),(n(!0),r(f,null,y(l.nutrients,(a,m)=>(n(),r("tr",{key:a},[e("th",zt,[t[8]||(t[8]=e("i",{class:"text-danger fst-normal"},"＊",-1)),c(" "+h(a),1)]),e("td",Et,[u(e("input",{"onUpdate:modelValue":p=>s.customizeData[m]=p,type:"number",name:m,id:m,class:"form-control text-center",required:"",min:"0",step:"0.0001"},null,8,Vt),[[b,s.customizeData[m]]]),t[9]||(t[9]=e("div",{class:"invalid-feedback"},"此欄位為必填",-1))])]))),128)),(n(!0),r(f,null,y(s.customizeData.baseClaimNts,(a,m)=>(n(),r("tr",{key:m},[e("th",Ut,[t[10]||(t[10]=e("i",{class:"text-danger fst-normal"},"＊",-1)),c(" "+h(l.header[m]),1)]),e("td",null,[u(e("input",{"onUpdate:modelValue":p=>s.customizeData.baseClaimNts[m]=p,type:"number",name:m,id:m,class:"form-control text-center",required:"",min:"0",step:"0.01"},null,8,Lt),[[b,s.customizeData.baseClaimNts[m]]])])]))),128)),(n(!0),r(f,null,y(s.customizeData.newClaimNts,(a,m)=>(n(),r("tr",{key:a+m},[e("th",Bt,[t[11]||(t[11]=e("i",{class:"text-danger fst-normal"},"＊",-1)),c(" "+h(a.chName)+"("+h(a.unit.match(/\((.*?)\)/)[1])+") ",1)]),e("td",null,[s.customizeData.newClaimNts?u((n(),r("input",{key:0,"onUpdate:modelValue":p=>s.customizeData.newClaimNts[m].quantity=p,id:a+m,name:a.quantity,type:"number",class:"form-control text-center",required:"",min:"0",step:"0.01"},null,8,Ot)),[[b,s.customizeData.newClaimNts[m].quantity]]):v("",!0)])]))),128))])]),e("div",null,[e("button",{onClick:t[2]||(t[2]=a=>d.openModal()),type:"button",class:"btn btn-outline-primary col-12"}," 新增其他營養素 ")])])],32)]),t[15]||(t[15]=e("div",{class:"modal-footer bg-light"},[e("button",{form:"AddCustomizeForm_id",type:"submit",class:"btn btn-primary"}," 送出資料 ")],-1))])])],512),w(M,{ref:"customizeClaimNtsModal"},null,512),w(i,{ref:"doubleCheckModal"},null,512)],64)}const Ft=V(yt,[["render",jt]]);export{Ft as C};
